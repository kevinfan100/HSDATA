# 信號視覺化分析系統 (最終版)

這個系統用於分析HSData二進制檔案，生成三種不同的響應圖：VD/VM疊圖、VM/DA分開圖和DA時域圖。

## 三種圖形功能

### 1. VD/VM疊圖 (VD/VM Overlay)
- **功能**: 顯示一個VD輸入通道對應六個VM輸出通道的響應
- **圖形特點**: 
  - 縱軸：VM電壓 (V)
  - 橫軸：VD電壓 (V)
  - 六個通道疊圖顯示
  - 類似於您提供的參考圖中的"Closed loop (Voltage Based)"圖形
- **處理方式**: 取固定幾個週期進行平均，提高信號品質
- **顯示內容**: 
  - 六個VM通道的響應曲線疊加
  - 自動選擇能量最大的VD通道作為輸入
  - 保持縱橫比的等比例顯示

### 2. VM/DA分開圖 (VM/DA Separate)
- **功能**: 顯示VM和DA數據的關係
- **圖形特點**:
  - 縱軸：VM電壓 (V)
  - 橫軸：DA電流 (A)
  - 六個通道分開呈現 (2×3子圖)
  - 類似於磁滯迴線分析
- **數據轉換**: 
  - DA數據從16bit (0-65535) 轉換為電壓 (±10V)
  - 電壓轉換為電流 (比例: 0.6)
- **顯示內容**: 
  - 每個通道的VM vs DA電流關係
  - RMS值統計
  - 10個週期的數據

### 3. DA時域圖 (DA Time Domain)
- **功能**: 顯示DA輸出的時域響應
- **圖形特點**:
  - 縱軸：DA電流 (A)
  - 橫軸：時間 (ms)
  - 六個通道分開呈現 (2×3子圖)
  - 固定10個週期的數據
- **顯示內容**: 
  - 每個通道的DA電流時域響應
  - RMS值和峰值統計
  - 完整的10個週期波形

## 系統參數

### DA轉換參數
- **DA範圍**: 16bit (0-65535)
- **電壓範圍**: ±10V
- **電流轉換比例**: 0.6 A/V

### 採樣參數
- **採樣頻率**: 100,000 Hz
- **數據格式**: HSData二進制格式

## 使用方法

### 基本使用
```python
python signal_visualization_final.py
```

### 程式結構
```
signal_visualization_final.py      # 最終版本 (推薦使用)
signal_visualization_optimized.py  # 優化版本
signal_visualization.py            # 原始版本
```

### 數據檔案要求
- **檔案格式**: `dc{頻率}.dat` (例如: `dc10.dat`)
- **檔案位置**: `0716_hsdata_dc/` 目錄下
- **數據結構**: HSData二進制格式

## 輸出圖形詳解

### 1. VD/VM疊圖
- **佈局**: 單一圖形，六條曲線疊加
- **顏色**: 黑、藍、綠、紅、洋紅、青
- **內容**: 每個VM通道對應VD輸入的響應
- **特點**: 類似於您提供的參考圖，顯示閉迴路特性

### 2. VM/DA分開圖
- **佈局**: 2×3 子圖
- **內容**: 每個通道的VM vs DA電流關係
- **信息**: RMS值、磁滯特性分析

### 3. DA時域圖
- **佈局**: 2×3 子圖
- **內容**: 每個通道的DA電流時域響應
- **信息**: RMS值、峰值、10個週期波形

## 技術特點

### 優化功能
- **單次數據讀取**: 避免重複讀取大檔案
- **週期平均**: 提高信號品質
- **自動通道選擇**: 智能選擇最佳輸入通道
- **錯誤處理**: 完整的異常處理機制

### 數據處理
- **週期檢測**: 自動檢測信號週期
- **邊界計算**: 智能選擇數據邊界
- **信號平均**: 多週期平均減少噪聲
- **單位轉換**: 完整的DA到電流轉換

## 與參考圖的對應

### VD/VM疊圖
- 對應您提供的"Closed loop (Voltage Based)"圖形
- 顯示六個通道的響應疊加
- 呈現高度線性的關係

### VM/DA分開圖
- 類似於磁滯迴線分析
- 顯示每個通道的VM vs DA電流關係
- 可以分析磁滯特性和能量損耗

## 依賴套件

```python
numpy
matplotlib
scipy
hsdata_reader  # 自定義模組
```

## 注意事項

1. **檔案大小**: 確保有足夠的記憶體處理大檔案
2. **數據品質**: 建議使用穩定的信號數據
3. **頻率匹配**: 確保檔名中的頻率與實際信號頻率一致
4. **圖形顯示**: 需要支援matplotlib的顯示環境

## 自定義設定

可以在程式中調整以下參數：
- `sampling_freq`: 採樣頻率
- `num_periods`: 平均週期數
- `current_ratio`: 電流轉換比例
- `voltage_range`: 電壓範圍

## 故障排除

### 常見問題
1. **檔案找不到**: 檢查檔案路徑和檔名格式
2. **記憶體不足**: 減少處理的週期數
3. **圖形顯示問題**: 確保matplotlib後端正確設定

### 調試信息
程式會輸出詳細的處理信息，包括：
- 數據載入進度
- 通道選擇結果
- 處理統計信息 